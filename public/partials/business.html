<!--
#########################################

    Business Page -- Consolidated View

########################################
-->
<div class="container" ng-cloak="">
    <div class="page-header text-center">
        <h1 class='text-center'>{{business.name}}</h1>

        <h3 class="text-center">
            <uib-rating class="text-warning" ng-model="business.rating" max="max" readonly="isReadonly"
                        on-hover="hoveringOver(value)" on-leave="overStar = null" titles="['one','two','three']">
            </uib-rating>
        </h3>
        <div class="row">
        <img ng-if="!business.photos" class="text-center" ng-src="{{business.icon}}" uib-tooltip="Photos coming soon..."
             tooltip-placement="right" style="border-radius:20%"></image>
			<span ng-if="business.photos.length >1" ng-repeat="photo in business.photos">
				<img ng-src="https://maps.googleapis.com/maps/api/place/photo?minwidth=200&maxwidth=200&minheight=133&maxheight=133&photoreference={{photo.photo_reference}}&key=AIzaSyAK1BOzJxHB8pOFmPFufYdcVdAuLr_6z2U">
			</span>
        </div>
        <br>

        <div class="row">
            <div class="col-xs-8 col-xs-offset-2">
                <ng-map class="map-container" center="{{center}}" zoom="16">
                    <marker position="{{center}}"></marker>
                </ng-map>
            </div>
        </div>


        <br>
        Google Places: <a href="{{business.url}}" target="_blank">{{business.url}}</a>
        <br>
        Business Website: <a href="{{business.website}}" target="_blank">{{business.website}}</a>
        <br>
        Location: {{business.formatted_address}}
        <br>
        Phone: {{business.formatted_phone_number}}
        <br>
        Hours:
			<span ng-if="business.opening_hours" ng-repeat="hours in business.opening_hours.weekday_text">
	    			<br>{{hours}}
			</span>
			<span ng-if="!business.opening_hours">
	    			No information about {{business.name}}'s hours of operation is available.
			</span>
    </div>
    <div class="col-xs-offset-11">
        <button class="btn btn-lg" ng-if="currentUser.user._id === business.info.owner" ng-click="toggleEdit()"
                ng-class="{'btn-warning': editMode === false,'btn-success':editMode === true}"><span
                ng-show="!editMode">Enable </span><span ng-show="editMode">Disable </span>Edit <i class="fa fa-cog"></i>
        </button>
    </div>
    <!--
#########################################

    Services Block

########################################
-->
    <div class="row">
        <div class="col-xs-2 col-xs-offset-5">
            <h1>Services</h1>
        </div>
        <div class="col-xs-1" ng-show="editMode">
            <button ng-click="open()" class="btn btn-success btn-default">New Service</button>
        </div>
    </div>

    <div class="row text-center">
        <h2 ng-if="business.info.services.length === 0">Services coming soon!</h2>

        <div class="col-md-3 col-xs-5 col-sm-3 well" ng-repeat="service in business.info.services track by $index">
            <div class="row">
                <div ng-show="editMode" class="adjustMargins pull-right">
                    <div class="btn-group">
                        <a class="btn btn-sm btn-warning dropdown-toggle" href="#" data-toggle="dropdown"><i
                                class="fa fa-cog"></i></a>
                        <ul class="dropdown-menu">
                            <li><a ng-click="editService(service, $index)" href="#"><i
                                    class="fa fa-pencil fa-fw"></i> Edit</a></li>
                            <li class="disabled"><a href="#"><i class="fa fa-trash-o fa-fw"></i> Delete</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div>
                <h2>{{service.name}}</h2>

                <h3>Price:{{service.price | currency}}</h3>

                <h3>Duration: {{service.duration}} minutes</h3>

                <h3>{{service.description}}</h3>
            </div>
            <div>
                <button class="btn btn-primary text-center btn-lg" ng-click="openService('lg');setService(service)">Book
                    <i class="fa fa-calendar"></i></button>
            </div>
        </div>
    </div>
    <!--
#########################################

    Employee Block

########################################
-->
    <div class="row">
        <div class="col-xs-2 col-xs-offset-5">
            <h1>Associates</h1>
            <span class="text-center">
            <uib-alert ng-show="employeeError.message" type="danger" dismiss-on-timeout="1000" close="removeAlert()">
                {{employeeError.message}}
            </uib-alert>
        </span>
        </div>
        <div class="col-xs-1" ng-show="editMode">
            <button ng-click="openEmployee()" class="btn btn-success">Add Associate</button>
        </div>
    </div>
    <div class="row">
        <h2 class="text-center" ng-if="business.info.employees.length === 0">No Associates Listed Yet!</h2>

        <div class="well col-md-3 col-xs-4 text-center" ng-repeat="employee in business.info.employees">
            <div class="row">
                <div ng-show="editMode" class="adjustMargins pull-right">
                    <button class="close" ng-click="removeEmployee(employee)"><i
                            class="fa fa-trash-o text-danger"></i></button>
                </div>
            </div>
            <div class="row">
                <img ng-if="!employee.avatarVersion" ng-src="{{cloudinaryDefaultPic}}">
                <img ng-if="employee.avatarVersion"
                     ng-src="{{cloudinaryBaseUrl}}{{employee.avatarVersion}}/profile/{{employee._id}}">

                <div class="">
                    <h4><a href="/user/{{employee._id}}/profile">{{employee.name}}</a></h4>
                </div>
            </div>
        </div>
        <div class="row" ng-if="!business.info.employees">
            <h1 class="text-center">Your business does not have any employee's registered yet.</h1>
        </div>
    </div>
    <!--
    #########################################

        Reviews Block

    ########################################
    -->
    <div class="row">
        <h1 class="text-center">Reviews</h1>

        <div class="row">
            <h2 class="text-center" ng-if="!business.reviews">No Reviews Yet!</h2>

            <div class="well col-md-6 col-sm-12 reviewBox" ng-repeat="review in business.reviews track by $index">
                <img ng-src="{{review.user.image_url}}" style="border-radius:20%"></img>
                <br>User: <span><a href="{{review.author_url}}">{{review.author_name}}</a></span>
                <br>
                Rating: {{review.rating}}
                <br>
                {{review.text}}
            </div>
        </div>
    </div>
    <!-- 	<div ng-if="!business.info.claimed" class="row text-center">
            <a href="#/claim/{{business.id}}">Claim Business</a>
        </div> -->
</div>

<!-- 
#########################################

	Schedule Appointment Modal

########################################
-->

<script type="text/ng-template" id="scheduleServiceModal.html">

    <div class="modal-header text-center">
        <button type="button" class="close" ng-click="cancel()" aria-hidden="true">&times;</button>
        <h3 class="modal-title text-center">{{service.name}} </h3>
        <timer ng-show="showCount" countdown="countdown" max-time-unit="'minute'" interval="1000" auto-start="false"
               finish-callback="timerFinished()">Appointment being held for: {{mminutes}} minute{{minutesS}},
            {{sseconds}} second{{secondsS}}
        </timer>
    </div>
    <div class="modal-body container-fluid">
        <ul class="hide nav nav-tabs" id="tabContent">
            <li class="active"><a data-target="#details" data-toggle="tab"></a></li>
            <li><a data-target="#employees" data-toggle="tab"></a></li>
            <li><a data-target="#schedule" data-toggle="tab"></a></li>
            <li><a data-target="#pay" data-toggle="tab"></a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="details">
                <div class="control-group">
                    <div class="row text-center">
                        <h2>{{service.description}}</h2>
                        <h5>Price:{{service.price |currency}}</h5>
                        <h5>Duration: {{service.duration}} minutes.</h5>
                        <h6 class="text-danger">Note: You will be charged at the time your service is completed.</h6>
                        <a data-target="#employees" data-toggle="tab" class="btn btn-primary">Next</a>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="employees">
                <div class="row text-center" style="margin-left:10px;margin-right:10px;">
                    <h3>Select an Associate</h3>

                    <div class="col col-md-3 well employeeHover" ng-repeat="employee in service.employees">
                        <label>
                            <img class="fitContainer" ng-if="!employee.avatarVersion" ng-src="{{cloudinaryDefaultPic}}">
                            <img class="fitContainer" ng-if="employee.avatarVersion"
                                 ng-src="{{cloudinaryBaseUrl}}{{employee.avatarVersion}}/profile/{{employee._id}}">
                            <h5>{{employee.name}}</h5>
                            <br>
                            <input name="selectEmployee" id="selectEmployee" ng-click="selectEmployee(employee)"
                                   type="radio">
                            Select
                        </label>
                    </div>
                </div>
                <div class="row text-center">
                    <a data-target="#details" data-toggle="tab" class="btn btn-warning">Back</a>
                    <a data-target="#schedule" data-toggle="tab" ng-show="employee" class="btn btn-primary">Next</a>
                </div>
            </div>
            <div class="tab-pane" id="schedule">
                <div class="row">
                    <div class="col col-md-6 text-center">
                        <h4>Select a Date to see Available Times</h4>

                        <div style="display:inline-block; min-height:290px;">
                            <uib-datepicker ng-model="selectedDate" min-date="minDate" show-weeks="true"
                                            class="well well-sm"
                                            custom-class="getDayClass(date, mode)"></uib-datepicker>
                        </div>
                    </div>
                    <div class="col col-md-6 text-center">
                        <h4 ng-if="availableTimes.length > 1">{{employee.name}}'s Available Times</h4>
                        <uib-alert ng-show="dayMessage" type="danger">{{employee.name}} is not available today.
                        </uib-alert>
                        <div class="col col-md-3" ng-click="createAppointmentObj(time,$index)"
                             ng-repeat="time in availableTimes track by $index">
                            <button ng-disabled="!time.available || time.status || time.toggled"
                                    ng-class="{'btn-danger': !time.available,'btn-warning':time.status,'btn-success':time.available && !time.toggled,'btn-primary':time.toggled}"
                                    role="button" class="btn" style="margin-bottom:5px;">
                                {{time.time}}
                            </button>
                        </div>
                    </div>
                </div>
                <div class="row text-center">
                    <a data-target="#employees" data-toggle="tab" class="btn btn-warning"> Back
                    </a>
                    <button class="btn btn-primary" ng-show="appointment" stripe-checkout="ctrl.checkOut"
                            data-key="pk_test_Hfdo0VXXOa2Om7YyYohtdRcb"
                            data-name="Bookd"
                            data-description="{{service.name}}"
                            data-amount="{{stripePrice}}"
                            data-image="/images/icon.png"
                            data-label="Book Appointment"
                            data-panel-label="Book">
                        Book Appointment
                    </button>
                </div>
            </div>
        </div>
    </div>
</script>
<!-- 
#########################################

	New service Modal

########################################
-->
<script type="text/ng-template" id="addServiceModal.html">
    <div class="modal-header">
        <button type="button" class="close" ng-click="cancel()" aria-hidden="true">&times;</button>
        <h3 class="modal-title text-center">New Service</h3>
    </div>
    <div class="modal-body">
        <div class="row">
            <form>
                <div class="form-group col-md-12">
                    <label for="serviceName">Service Name:</label>
                    <input class="form-control" id="serviceName" ng-required ng-model="service.name">
                </div>
                <div class="col-md-12">
                    <label>Employees:</label>
                </div>
                <div class="col-md-12">
                    <div ng-dropdown-multiselect="" options="business.employees" extra-settings="settings"
                         selected-model="serviceEmployees"></div>
                </div>
                <div class="form-group col-md-12">
                    <label for="price">Price:</label>
                    <select class="form-control" id="price" ng-model="service.price" placeholder="$0">
                        <option value="" disabled selected>Select Service Price</option>
                        <option value="5">$5</option>
                        <option value="10">$10</option>
                        <option value="15">$15</option>
                        <option value="20">$20</option>
                    </select>
                </div>
                <div class="form-group col-md-12">
                    <label>Duration:</label>
                    <select class="form-control" ng-model="service.duration">
                        <option value="">Select a Duration</option>
                        <option value="15">15 Minutes</option>
                        <option value="30">30 Minutes</option>
                        <option value="60">60 Minutes</option>
                    </select>
                </div>
                <div class="form-group col-md-12">
                    <label for="serviceDescription">Description:</label>
                    <textarea class="form-control" id="serviceDescription" ng-model="service.description"></textarea>
                </div>
            </form>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" ng-click="ok(service)">Create</button>
        <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
    </div>
</script>
<!--
#########################################

	Edit service Modal

########################################
-->
<script type="text/ng-template" id="editServiceModal.html">
    <div class="modal-header">
        <button type="button" class="close" ng-click="cancel()" aria-hidden="true">&times;</button>
        <h3 class="modal-title text-center">Edit Service</h3>
    </div>
    <div class="modal-body">
        <div class="row">
            <form>
                <div class="form-group col-md-12">
                    <label for="serviceName">Service Name:</label>
                    <input class="form-control" id="editServiceName" ng-model="editService.name">
                </div>
                <div class="col-md-12">
                    <label>Employees: <span
                            ng-repeat="employee in editService.employees"> {{employee.name}}</span></label>
                </div>
                <div class="col-md-12">
                    <div ng-dropdown-multiselect="" options="business.employees" extra-settings="settings"
                         selected-model="serviceEmployees"></div>
                </div>
                <div class="form-group col-md-12">
                    <label for="price">Price:</label>
                    <select class="form-control" id="editPrice" ng-model="editService.price" placeholder="$0">
                        <option value="" disabled selected>Select Service Price</option>
                        <option value="5">$5</option>
                        <option value="10">$10</option>
                        <option value="15">$15</option>
                        <option value="20">$20</option>
                    </select>
                </div>
                <div class="form-group col-md-12">
                    <label>Duration:</label>
                    <select class="form-control" ng-model="editService.duration">
                        <option value="">Select a Duration</option>
                        <option value="15">15 Minutes</option>
                        <option value="30">30 Minutes</option>
                        <option value="60">60 Minutes</option>
                    </select>
                </div>
                <div class="form-group col-md-12">
                    <label for="serviceDescription">Description:</label>
                    <textarea class="form-control" id="editServiceDescription"
                              ng-model="editService.description"></textarea>
                </div>
            </form>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" ng-click="ok(editService)">Save</button>
        <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
    </div>
</script>
<!-- 
#########################################

	New Employee Modal

########################################
-->
<script type="text/ng-template" id="addEmployeeModal.html">
    <div class="modal-header">
        <button type="button" class="close" ng-click="cancel()" aria-hidden="true">&times;</button>
        <h3 class="modal-title text-center">New Employee</h3>
    </div>
    <div class="modal-body">
        <form>
            <div class="row form-inline employee-search">
                <div class="form-group col-md-12">
                    <label for="employeeId">Employee Email:</label>
                    <input class="form-control" type="email" id="employeeId" ng-model="id">
                    <button class="btn btn-success" ng-click="findEmployee(id)">
                        Search
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12" ng-if="employee">
                    <img ng-if="employee.avatarVersion && employee.provider == 'bookd'"
                         ng-src="{{cloudinaryBaseUrl}}{{employee.avatarVersion}}/profile/{{employee._id}}"
                         style="height:100px;width:100px;">
                    <img ng-if="!employee.avatarVersion && employee.provider == 'bookd'"
                         ng-src="{{cloudinaryDefaultPic}}"
                         style="height:100px;width:100px;">
                    <!--<img ng-if="employee.provider == 'google_plus'" ng-src="https://www.googleapis.com/plus/v1/people/{{employee.providerID}}?fields=image&key=" style="height:100px;width:100px;">-->
                    <!--<img ng-if="employee.provider == 'facebook'" src="https://graph.facebook.com/{{employee.providerID}}?fields=picture.type(large)" style="height:100px;width:100px;">-->
                    <p>Name: {{employee.name}}</p>
                </div>
                <div class="col-md-12" ng-if="!employee && searched">
                    <p>No employee with that email found.</p>
                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" ng-disabled="!employee" ng-click="create(employee._id)">Register Employee
        </button>
        <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
    </div>
</script>

<!--
#########################################

Remove Employee Modal

########################################
-->
<script type="text/ng-template" id="removeEmployeeModal.html">
    <div class="modal-header">
        <button type="button" class="close" ng-click="cancel()" aria-hidden="true">&times;</button>
        <h3 class="modal-title text-center">Remove Employee</h3>
    </div>
    <div class="modal-body">
        <div ng-if="employeeHasService">
            <h4>{{employee.name}} is the only employee associated with the following service(s):</h4>
            <ul>
                <li class="h5" ng-repeat="service in associatedServices">{{service}}</li>
            </ul>
            <h4>Please delete or assign another employee to the service(s) before deleting {{employee.name}}.</h4>
        </div>
        <h4 ng-if="!employeeHasService">Are you sure you would like to remove {{employee.name}}
            {{employee.lastName}}?</h4>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" ng-if="!employeeHasService" ng-click="remove()">Yes, remove {{employee.name}}
        </button>
        <button class="btn btn-primary" ng-if="employeeHasService" ng-click="cancel()">Ok</button>
        <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
    </div>
</script>

